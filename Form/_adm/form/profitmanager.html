<div class="con_head_wrap">
    <div class="con_head">
        <h1><?=$_TITLE_SUB ? $SITE_NAME.'-'.$_TITLE_SUB : $SITE_NAME.'-'.$_TITLE?></h1>
    </div>
</div>
<div class="con_body_wrap">
    <div class="con_body">
        <div class="con_body_top_form_wrap">
            <div class="row">
                <div class="col-xs-12">
                    <div class="cloud_box">
                        <form class="form-search">
                            <input type="hidden" id='_token' name="_token" value="">
                            <input type="hidden" name="BCODE" value="<?=$BCODE?>">
                            <div class="form_search_wrap">
                                <label class="form_search_label">검색어</label>
                                <div class="form_search_desc">
                                    <div class="form_div_wrap">
                                        <div class="form_select_box_wrap">
                                            <select class="selectpicker" name="keyword">
                                                <option value="m_id" <?=$_REQUEST["keyword"]=="m_id"?" selected":""?>>출금신청아이디</option>
                                            </select>
                                        </div>
                                        <div class="search_box_wrap">
                                            <input type="text" name="word" value="<?=$_REQUEST['word']?>" class="form-control" id="" placeholder="검색어를 입력해주세요.">
                                        </div>
                                    </div>
                                </div>
                                <div class="form_search_wrap">
                                    <label class="form_search_label">기간검색</label>
                                    <div class="form_search_desc">
                                        <div class="form_div_wrap">
                                            <div class="date_tab_wrap">
                                                <div class="btn-group" data-toggle="buttons">
                                                    <label class="btn btn_radio date_today <?php if($options=='today') echo 'active'; ?>">
                                                        <input type="radio" name="options" id="option1" value="today" <?php if($options=='today') echo 'checked'; ?> onchange="check_date(this.value)" >
                                                        오늘
                                                    </label>
                                                    <label class="btn btn_radio date_3days <?php if($options=='3days') echo 'active'; ?>">
                                                        <input type="radio" name="options" id="option2" value="3days" <?php if($options=='3days') echo 'checked'; ?> onchange="check_date(this.value)" >
                                                        3일
                                                    </label>
                                                    <label class="btn btn_radio date_week <?php if($options=='week') echo 'active'; ?>">
                                                        <input type="radio" name="options" id="option3" value="week" <?php if($options=='week') echo 'checked'; ?> onchange="check_date(this.value)" >
                                                        1주일
                                                    </label>
                                                    <label class="btn btn_radio date_month <?php if($options=='month') echo 'active'; ?>">
                                                        <input type="radio" name="options" id="option4" value="month" <?php if($options=='month') echo 'checked'; ?> onchange="check_date(this.value)" >
                                                        1개월
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="date_input_wrap">
                                                <div class="input-group input-daterange">
                                                    <input type="text" class="form-control date_input" value="<?=$_REQUEST['date_from'];?>" id="date_from" name="date_from">
                                                    <div class="input-group-addon">~</div>
                                                    <input type="text" class="form-control date_input" value="<?=$_REQUEST['date_to'];?>" id="date_to" name="date_to">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form_search_wrap">
                                    <label class="form_search_label"></label>
                                    <div class="form_search_desc">
                                        <div class="form_div_wrap">
                                            <div class="date_tab_wrap">
                                                <div class="btn-group" data-toggle="buttons">
                                                    <label class="btn btn_radio cate_all <?php if($cate=='ALL') echo 'active'; ?>">
                                                        <input type="radio" name="cate" id="cate1" value="ALL" <?php if($cate=='ALL') echo 'checked'; ?> " >
                                                        전체
                                                    </label>
                                                    <label class="btn btn_radio cate_wait <?php if($cate=='W') echo 'active'; ?>">
                                                        <input type="radio" name="cate" id="cate2" value="W" <?php if($cate=='W') echo 'checked'; ?> " >
                                                        대기
                                                    </label>
                                                    <label class="btn btn_radio cate_complet <?php if($cate=='Y') echo 'active'; ?>">
                                                        <input type="radio" name="cate" id="cate3" value="Y" <?php if($cate=='Y') echo 'checked'; ?> " >
                                                        완료
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="date_btn_wrap">
                                                <button type="submit" class="btn btn-primary">검색</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="con_body_mid_wrap">
            <div class="row">
                <div class="col-xs-12">
                    <div class="cloud_box">
                        <div class="table_all_wrap">
                            <div class="table_top_wrap">
                                <div class="table_top_left">
                                    <div class="table_top_left_label_wrap">
										<span class="table_top_left_label">
											검색결과
										</span>
                                        <span class="table_top_left_desc">
											<b><?=number_format($total)?></b>건
										</span>
                                    </div>
                                </div>
                                <div class="table_top_right">

                                    <!-- <div class="table_top_right_btn_wrap">
                                        <button type="button" class="btn excel_btn">엑셀다운로드</button>
                                    </div>
                                    <div class="table_top_right_input_wrap">
                                        <div class="select_box_wrap">
                                            <select class="selectpicker">
                                                <option>최신순</option>
                                                <option>이름순</option>
                                            </select>
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                            <div class="table_body_wrap">
                                <div class="table_wrap">
                                    <form method="post" name="profitUpdate" id="profitUpdate" action="" enctype="multipart/form-data">
                                        <input type="hidden" name="dbControl" value="setPointWithdrawal">
                                        <input type="hidden" name="p_status" id="p_status" value="">
                                        <input type="hidden" name="p_idx" id="p_idx" value="">
                                        <input type="hidden" name="pc_idx" id="pc_idx" value="">
                                        <input type="hidden" name="m_idx" id="m_idx" value="">
                                        <input type="hidden" name="RETURNURL" value="<?=str_replace('.form', '', $PUSANKJS['filename'])?>">
                                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table_st_01">
                                            <tr>
                                                <th class="td_num">번호</th>
                                                <th class="td_username">출금신청ID</th>
                                                <th class="td_username">출금신청자명</th>
                                                <th class="td_order">출금신청금액(위안)</th>
                                                <th class="td_order">계좌번호</th>
                                                <th class="td_username">입금자명</th>
                                                <th class="td_username">출금신청일자</th>
                                                <th class="td_username">출금완료일자</th>
                                                <th class="td_order">상태</th>
                                                <th class="" colspan="2">관리</th>
                                            </tr>
                                            <?php
										if(count($list) > 0){
                                            for($i=0; $i < count($list); $i++){
                                            $codename = codename(substr($list[$i]['m_option1'],0,4),substr($list[$i]['m_option1'],4,4),'C');
                                            ?>
                                            <tr>
                                                <td class="td_num"><?=$list[$i]['num']?></td>
                                                <td class="td_donator"><?=setOutput($list[$i]['p_m_id'])?></td>
                                                <td class="td_donator"><?=setOutput($list[$i]['to_name'])?></td>
                                                <td class="td_order"><?=setOutput($list[$i]['p_point_cn'])?></td>
                                                <td class="td_username"><?=setOutput($list[$i]['m_bank'])?><?=setOutput($list[$i]['m_account'])?></td>
                                                <td class="td_username"><?=setOutput($list[$i]['m_account_holder'])?></td>
                                                <td class="td_username"><?=setOutput($list[$i]['p_regdate'])?></td>
                                                <td class="td_username"><?=setOutput($list[$i]['p_refunddate'])?></td>
                                                <?php if($list[$i]['p_use_is']=="Y"){?>
                                                <td class="td_order">출금완료</td>
                                                <?php }else if($list[$i]['p_use_is']=="W"){?>
                                                <td style="font-weight: bold; color: red;" class="td_order">출금신청</td>
                                                <?php }else{?>
                                                <td class="td_order">적립</td>
                                                <?php }?>
                                                <td class="td_bt">
                                                    <div class="order_btn_wrap">
                                                        <?php
														    if($list[$i]['p_use_is'] != "Y"){
													    ?>
                                                        <button type="button" class="btn btn-delete" onclick="boardDelFn('/lib/control.siso', '<?=$list[$i]['idx']?>', 'setPointDel', '1')">내역삭제</button>
                                                        <?php  } ?>
                                                    </div>
                                                </td>
                                                <td class="td_bt">
                                                    <div class="order_btn_wrap">
                                                        <?php if($list[$i]['p_use_is']=="W"){?>
                                                        <button type="button" class="btn btn-delete red" style="background-color: red; color: black"  onclick="pointWithdrawalFn('/lib/control.siso','<?=$list[$i]['idx']?>','setPointWithdrawal','1')">출금완료</button>
                                                        <?php }?>
                                                    </div>
                                                </td>
                                            </tr>
                                            <?php 	}	}else{?>
                                            <tr>
                                                <td colspan="12" class="td_none">
                                                    자료가 없습니다.
                                                </td>
                                            </tr>
                                            <?php 	} ?>
                                        </table>
                                    </form>
                                </div>
                            </div>
                            <div class="table_bottom_btn_wrap">
                                <!--								<a href='menu.form.siso' class="btn btn-primary">추가</a>-->
                            </div>
                            <div class="table_page_wrap">
                                <?=$paging?>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style type="text/css">
    .td_store {
        width: 80px;
    }
    .td_donate {
        width: 160px;
    }
    td.td_donate {
        text-align: right;
        padding-right: 20px;
    }
</style>


<script>
    $(document).ready(function(){
        var date_from = document.getElementById('date_from').value;
        var date_to = document.getElementById('date_to').value;

        if(date_from == '' || date_to == ''){
            //init();
            check_date("today");
            $('.date_todays').addClass("active");
        }

        if(("<?=$cate?>" == "all") || ("<?=$cate?>" == "")){
            $('.cate_tab_wrap label').removeClass("active");
            $('.cate_all').addClass("active");
            $('input[name="cate"]').attr("checked", false);
            $('#cate1').attr("checked", true);
        }else if("<?=$cate?>" == "sponsor"){
            $('.cate_tab_wrap label').removeClass("active");
            $('.cate_sponsor').addClass("active");
            $('input[name="cate"]').attr("checked", false);
            $('#cate2').attr("checked", true);
        }else if("<?=$cate?>" == "user"){
            $('.cate_tab_wrap label').removeClass("active");
            $('.date_user').addClass("active");
            $('input[name="cate"]').attr("checked", false);
            $('#cate3').attr("checked", true);
        }
    });

    function getDt(s,i,t) {
        var newDt = new Date(s);
        newDt.setDate(newDt.getDate() - i);
        if(t == "DD") {
            return converDateStringDD(newDt);
        }else if(t == "MM") {
            return converDateStringMM(newDt);
        }else if(t == "YY"){
            return converDateStringMM(newDt);
        }else{
            return 0;
        }
    }

    function converDateStringYY(dt){
        var yyyy = dt.getYear();
        var mm = ((dt.getMonth()+1) < 10 ? "0" + (dt.getMonth()+1) : (dt.getMonth()+1));
        var dd = (dt.getDate() < 10 ? "0" + dt.getDate() : dt.getDate());

        return yyyy;
        //return "" + yyyy + "." + mm + "." + dd ;
    }

    function converDateStringMM(dt){
        var yyyy = dt.getYear();
        var mm = ((dt.getMonth()+1) < 10 ? "0" + (dt.getMonth()+1) : (dt.getMonth()+1));
        var dd = (dt.getDate() < 10 ? "0" + dt.getDate() : dt.getDate());

        return mm;
        //return "" + yyyy + "." + mm + "." + dd ;
    }

    function converDateStringDD(dt){
        var yyyy = dt.getYear();
        var mm = ((dt.getMonth()+1) < 10 ? "0" + (dt.getMonth()+1) : (dt.getMonth()+1));
        var dd = (dt.getDate() < 10 ? "0" + dt.getDate() : dt.getDate());

        return dd;
        //return "" + yyyy + "." + mm + "." + dd ;
    }

    function check_date(checkvalue){

        //var from_date = document.getElementById('date_from').value;
        var today = new Date();
        var yyyy = today.getFullYear();
        var mm = today.getMonth()+1;
        var monthmm = today.getMonth();
        var dd = today.getDate();
        //var threedd = today.getDate()-3;
        var threemm = getDt(today,3,'MM');
        var threedd = getDt(today,3,'DD');
        var weekmm = getDt(today,7,'MM');
        var weekdd = getDt(today,7,'DD');
        // var weekdd = today.getDate()-7;

        if(dd<10) {
            dd='0'+dd
        }
        if(mm<10) {
            mm='0'+mm
        }
        if(monthmm<10) {
            monthmm='0'+monthmm
        }
        // if(weekdd<10) {
        //     weekdd='0'+weekdd
        // }
        // if(threedd<10) {
        //     if(threedd < 0){
        //         threedd='0'+threedd
        //     }else{
        //         threedd='0'+threedd
        //     }
        //
        // }
        today = yyyy + '-' + mm + '-' + dd;

        var threedays = yyyy + '-' + threemm + '-' + threedd;
        var week = yyyy + '-' + weekmm + '-' + weekdd;
        var month = yyyy + '-' + monthmm + '-' + dd;

        document.getElementById('date_to').value = today;

        if(checkvalue == "today"){
            document.getElementById('date_from').value = today;
        }else if(checkvalue == "3days"){
            document.getElementById('date_from').value = threedays;
        }else if(checkvalue == "week"){
            document.getElementById('date_from').value = week;
        }else{
            document.getElementById('date_from').value = month;
        }
    }

    // function paymentFn(id,p_idx,p_user_idx,pc_idx){
    //
    //     var frm = document.profitUpdate;
    //     frm.p_status.value = id;
    //     frm.p_idx.value = p_idx;
    //     frm.pc_idx.value = pc_idx;
    //     frm.m_idx.value = p_user_idx;
    //
    //     ajaxFormSave('profitUpdate', '/lib/control.siso');
    // }

    function pointWithdrawalFn(path, code, control, val){
        if(confirm('출금완료처리를 하시겠습니까?')){
            setAjaxPostSend(path, code, control, val);
        }
    }

</script>