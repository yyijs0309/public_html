<style type="text/css">
	.table_box_wrap .table_st_01 td {
		text-align: left;
	}
	.table_box_wrap .table_st_01 td.td_group {
		text-align: center;
	}
	.table_box_wrap_01 {
		padding-bottom: 10px;
	}
	.td_group a {
		color: #666;
		background-color: #fefefe;
		border: 1px solid #ddd;
		padding: 5px 10px;
		display: inline-block;
		text-align: center;
		border-radius: 3px;
		font-family: 'no300';
		min-width: 100px;
	}
	.td_group a:hover {
		color: #fff;
		background-color: #336ef4;
		border-color: #336ef4
	}
	.td_group a.active {
		color: #fff;
		background-color: #336ef4;
		border-color: #336ef4
	}
</style>
<div class="con_head_wrap">
	<div class="con_head">
		<h1><?=$_TITLE_SUB ? $SITE_NAME.'-'.$_TITLE_SUB : $SITE_NAME.'-'.$_TITLE?></h1>
	</div>
</div>
<div class="con_body_wrap">
	<div class="con_body">
		<div class="con_body_mid_wrap">
			<div class="row">
				<div class="col-xs-12">
					<div class="cloud_box">
						<div class="form_search_wrap">
							<label class="form_search_label">권한선택</label>
							<div class="form_search_desc">
								<div class="row">
									<div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
										<div class="table_box_wrap table_box_wrap_01">
											<form class="form-search" id="frm" name="frm">
											<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table_st_01">
												<input type="hidden" id="check_yn" name="check_yn" value="<?=$check_yn?>">
												<input type="hidden" name="a_idx" value="<?=$a_idx?>">
												<tr>
													<th class="td_group">
														사용자 그룹
													</th>
												</tr>
												<?php
												if(count($authlist)>0){
													for($i=0;count($authlist)>$i;$i++){
												?>
												<tr>

													<td class="td_group">
														<a href="javascript:srch_submit(<?=$authlist[$i]['a_idx']?>)" <?php if($authlist[$i]['a_idx'] == $a_idx){?>class="active"<?php }?> > <?=$authlist[$i]['a_authgroup_name']?></a>
													</td>
												</tr>
												<?php 	}	}else{?>
												<tr>
													<td colspan="1" class="td_none">
														자료가 없습니다.
													</td>
												</tr>
												<?php 	} ?>
											</table>
											</form>
										</div>
									</div>
									<div class="col-xs-12 col-sm-6 col-md-6 col-lg-4">
										<div class="table_box_wrap table_box_wrap_02">
											<form class="form-search" id="saveAuth" name="saveAuth">
											<input type="hidden" name="dbControl" value="saveAuth">
											<input type="hidden" name="chkidx" value="">
											<input type="hidden" name="maidx" value="">
											<input type="hidden" name="aidx" id="aidx" value="<?=$a_idx?>">
											<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table_st_01">
												<tr>
													<th class="td_chk">
														<div class="td_chk_box_wrap">
															<input type="checkbox" id="allCheck">
															<label for="allCheck">
																<span>전체 선택/해제</span>
															</label>
														</div>
													</th>
													<th class="td_menu_name">
														메뉴명
													</th>
												</tr>
												<?php
												if(count($menulist)>0){
													for($j=0;count($menulist)>$j;$j++){
												?>
												<tr>
													<td class="td_chk">
														<div class="td_chk_box_wrap">
															<input type="hidden" name="ma_idx[]" value="<?=$menulist[$j]['ma_idx']?>" >
															<input type="hidden" name="ma_state[]" value="<?=$menulist[$j]['check_box']?>" >
															<input type="checkbox" id="chk_id_<?=$j?>" name="chk_id[]" value="<?=$j?>" <?php if($menulist[$j]['check_box'] == 'Y'){?>checked<?php }?> >
															<label for="chk_id_<?=$j?>">
																<span>선택</span>
															</label>

														</div>
													</td>
													<td class="td_menu_name">
														<?=$menulist[$j]['m_menu_name']?>
													</td>
												</tr>
												<?php 	}	}else{?>
												<tr>
													<td colspan="2" class="td_none">
														자료가 없습니다.
													</td>
												</tr>
												<?php 	} ?>
<!--												<tr>-->
<!--													<td class="td_chk">-->
<!--														<div class="td_chk_box_wrap">-->
<!--															<input type="checkbox" id="chk_id_1" name="chk_id_1" value="">-->
<!--															<label for="chk_id_1">-->
<!--																<span>선택</span>-->
<!--															</label>-->
<!--														</div>-->
<!--													</td>-->
<!--													<td class="td_menu_name">-->
<!--														메뉴명입니다.-->
<!--													</td>-->
<!--												</tr>-->
<!--												<tr>-->
<!--													<td class="td_chk">-->
<!--														<div class="td_chk_box_wrap">-->
<!--															<input type="checkbox" id="chk_id_2" name="chk_id_2" value="">-->
<!--															<label for="chk_id_2">-->
<!--																<span>선택</span>-->
<!--															</label>-->
<!--														</div>-->
<!--													</td>-->
<!--													<td class="td_menu_name">-->
<!--														메뉴명입니다.-->
<!--													</td>-->
<!--												</tr>-->
<!--												<tr>-->
<!--													<td class="td_chk">-->
<!--														<div class="td_chk_box_wrap">-->
<!--															<input type="checkbox" id="chk_id_3" name="chk_id_3" value="">-->
<!--															<label for="chk_id_3">-->
<!--																<span>선택</span>-->
<!--															</label>-->
<!--														</div>-->
<!--													</td>-->
<!--													<td class="td_menu_name">-->
<!--														메뉴명입니다.-->
<!--													</td>-->
<!--												</tr>-->
											</table>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="form_search_wrap">
							<label class="form_search_label">권한저장</label>
							<div class="form_search_desc">
								<div class="form_div_wrap">
									<div class="date_btn_wrap">
										<button type="button" id="saveBtn" class="btn btn-primary" >저장</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$('#saveBtn').click(function(){
			var chk_id = document.getElementsByName("chk_id[]");
			var ma_idx = document.getElementsByName("ma_idx[]");
			var ma_state = document.getElementsByName("ma_state[]");
			var len = chk_id.length;
			var checkRow = '';
			var checkCnt = 0;
			var checkLast = '';
			var rowid = '';
			var cnt = 0;

			var malen = ma_idx.length;
			var macheckRow = '';
			var marowid = '';

			for(var i=0; i<malen; i++){
				if(chk_id[i].checked == true){
					checkCnt++;									//체크된 체크박스의 개수
					checkLast = i;								//체크된 체크박스의 인덱스
				}
			}
			for(var i=0; i<malen; i++){
				if(chk_id[i].checked == true){						//체크가 되어있는 값 구분
					checkRow = "Y";
					macheckRow = ma_idx[i].value;
					if(checkCnt == 1){								//체크된 체크박스의 개수가 한 개 일때,
						rowid += ""+checkRow+"";					//'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
						marowid += ""+macheckRow+"";
					}else{											//체크된 체크박스의 개수가 여러 개 일때,
						if(i == malen-1){							//체크된 체크박스 중 마지막 체크박스일 때,
							rowid += ""+checkRow+"";				//'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
							marowid += ""+macheckRow+"";
						}else{
							rowid += ""+checkRow+",";				//'value',의 형태 (뒤에 ,(콤마)가 붙게)
							marowid += ""+macheckRow+",";
						}
					}
					cnt++;
					checkRow = '';									//checkRow초기화.
				}else{
					checkRow = "N";
					macheckRow = ma_idx[i].value;
					if(checkCnt == 1){								//체크된 체크박스의 개수가 한 개 일때,
						rowid += ""+checkRow+"";					//'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
						marowid += ""+macheckRow+"";
					}else{											//체크된 체크박스의 개수가 여러 개 일때,
						if(i == malen-1){							//체크된 체크박스 중 마지막 체크박스일 때,
							rowid += ""+checkRow+"";				//'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
							marowid += ""+macheckRow+"";
						}else{
							rowid += ""+checkRow+",";				//'value',의 형태 (뒤에 ,(콤마)가 붙게)
							marowid += ""+macheckRow+",";
						}
					}
					cnt++;
					checkRow = '';									//checkRow초기화.
					macheckRow = '';
				}
			}

			// for(var i=0; i<len; i++){
			// 	if(chk_id[i].checked == true){
			// 		checkCnt++;									//체크된 체크박스의 개수
			// 		checkLast = i;								//체크된 체크박스의 인덱스
			// 	}
			// }
			// for(var i=0; i<len; i++){
			// 	if(chk_id[i].checked == true){						//체크가 되어있는 값 구분
			// 		checkRow = ma_idx[i].value;
			//
			// 		if(checkCnt == 1){								//체크된 체크박스의 개수가 한 개 일때,
			// 			rowid += ""+checkRow+"";					//'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
			// 		}else{											//체크된 체크박스의 개수가 여러 개 일때,
			// 			if(i == checkLast){							//체크된 체크박스 중 마지막 체크박스일 때,
			// 				rowid += ""+checkRow+"";				//'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
			// 			}else{
			// 				rowid += ""+checkRow+",";				//'value',의 형태 (뒤에 ,(콤마)가 붙게)
			// 			}
			// 		}
			// 		cnt++;
			// 		checkRow = '';									//checkRow초기화.
			// 	}
			// }

			// if(checkCnt == 0){
			// 	alert("한개 이상 체크하세요");
			// 	return;
			// }

			var frm = document.saveAuth;
			frm.chkidx.value = rowid;
			frm.maidx.value = marowid;
			frm.aidx.value = document.getElementById("aidx").value;

			//alert(document.getElementById("aidx").value);
			ajaxFormSave('saveAuth', '/lib/control.siso');
		}).css({"cursor":"pointer"});
	});

	$(document).on("change", "#allCheck", function() {
		if($("#allCheck").prop("checked")){
			$(".table_box_wrap_02 .td_chk_box_wrap input[type='checkbox']").prop("checked",true);
		} else {
			$(".table_box_wrap_02 .td_chk_box_wrap input[type='checkbox']").prop("checked",false);
		}
	});

	function srch_submit(value)
	{
		var frm = document.frm;
		frm.check_yn.value = value;
		frm.a_idx.value = value;
		frm.submit();
	}
</script>